<!DOCTYPE html>
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
#tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 150px; height: 100px;
    background: white;
    border: 0px;
}
</style>
<body onload='init()'>
<svg width=1000 height=1000>
</svg>
<div id="tooltip"></div>
<script>
async function init() {

  const data = await d3.csv('https://dixonliang.github.io/EPLData.csv');

  var width = 750;
  var height = 750;
  var margin = 100;

  var color = d3.scaleOrdinal().domain(["Manchester City","Liverpool","Chelsea","Tottenham Hotspur","Arsenal",
  "Manchester United","Wolverhampton Wanderers","Everton","Leicester City","West Ham United","Watford","Crystal Palace",
  "Newcastle United","AFC Bournemouth","Burnley","Southampton","Brighton & Hove Albion","Cardiff City","Fulham","Huddersfield Town"])
  .range(["purple","red","blue","skyblue","crimson",
  "darkred","gold","darkblue","teal","maroon","yellow","royalblue",
  "black","darkred","brown","tomato","powderblue","aqua","slategray","cornflowerblue"]);

  var xs = d3.scaleLinear().domain([0,0.9]).range([0,width]);
  var ys = d3.scaleLinear().domain([0,0.6]).range([height,0]);
  var x = d3.scaleLinear().domain([0,0.9]).range([0,width]);
  var y = d3.scaleLinear().domain([0,0.6]).range([height,0]);
  var tooltip = d3.select("#tooltip");

  d3.select("svg")
  .attr("width",width + 2*margin)
  .attr("height",height + 2*margin)
  .append("g")
  .attr("transform","translate("+margin+","+margin+")")
  .selectAll("body").data(data).enter().append("circle")
  .filter(function(d) {return d.minutes_played_overall > 500 })
  .attr("cx",function(d) {return xs(d.goals_per_90_overall); })
  .attr("cy",function(d) {return ys(d.assists_per_90_overall); })
  .attr("r",function(d) {return 4; })
  .attr("fill", d=>color(d["Current Club"]) )
  .on("mouseover", function(d) {
          tooltip.style("opacity", 1)
                 .style("left",(d3.event.pageX)+"px")
                 .style("top",(d3.event.pageY)+"px")
                 .html("Team: "+d["Current Club"]+ "<br>" +
                 "Player: "+d.full_name+ "<br>" +
                 "Goals:  "+d.goals_overall+ "<br>" +
                 "Assists: "+d.assists_overall
               );
      })
  .on("mouseout", function() { tooltip.style("opacity", 0); });

  d3.select("svg").append("g")
  .attr("transform","translate("+margin+","+margin+")")
  .call(d3.axisLeft(y));

  d3.select("svg").append("g")
  .attr("transform","translate("+margin+","+(height+margin)+")")
  .call(d3.axisBottom(x));

// add x-axis title
  d3.select("svg").append("text")
    .attr("transform",
          "translate("+(width/2)+","+(height+margin+50)+")")
    .style("text-anchor", "center")
    .text("Goals Per 90 Minutes");

// add y-axis title
  d3.select("svg").append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 0 - margin.left)
    .attr("x",0 - (height / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Assists Per 90 Minutes");

// add title
  d3.select("svg").append("text")
  .attr("x", (width / 2))
  .attr("y", margin)
  .attr("text-anchor", "center")
  .attr("font-weight", 600)
  .style("font-size", "24px")
  .text("2018/2019 Premier League Attacking Player Efficiency");

// add annotation
  d3.select("svg").append("text")
  .attr("x", (width / 2))
  .attr("y", (margin + 30))
  .attr("text-anchor", "center")
  .style("font-size", "16px")
  .text("*minimum of 500 minutes played*");

}

</script>
</body>
</html>
